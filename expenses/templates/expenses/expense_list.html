{% extends "base.html" %}

{% block content %}

<div class="container mt-4">
    <div class="row">
        <!-- Form section -->
        <div class="col-md-3 mb-4">
            <h2 class="mb-4 text-dark" style="font-size: 2.5rem; font-weight: bold;">Expenses</h2> 

            <a href="{% url 'expenses:expense-create' %}" class="btn btn-primary mb-3">Add Expense</a>

            <form method="get" action="">
                <div class="mb-3">
                    <label for="id_name" class="form-label">Name:</label>
                    <input type="text" name="name" id="id_name" class="form-control" value="{{ form.name.value|default:'' }}">
                </div>
                <div class="mb-3">
                    <label for="id_date_from" class="form-label">Date from:</label>
                    <input type="date" name="date_from" id="id_date_from" class="form-control" value="{{ form.date_from.value|default:'' }}">
                </div>
                <div class="mb-3">
                    <label for="id_date_to" class="form-label">Date to:</label>
                    <input type="date" name="date_to" id="id_date_to" class="form-control" value="{{ form.date_to.value|default:'' }}">
                </div>
                <div class="mb-3">
                    <label for="id_category" class="form-label">Categories:</label>
                    <div class="form-check d-flex flex-column align-items-start">
                        {% for choice in form.category.field.choices %}
                            <div class="form-check">
                                <input type="checkbox" name="category" value="{{ choice.0 }}" class="form-check-input"
                                    {% if choice.0|stringformat:"s" in form.category.value|default_if_none:'' %}checked{% endif %}>
                                <label class="form-check-label">{{ choice.1 }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="mb-3">
                    <label for="sort_by" class="form-label">Sort by:</label>
                    <select name="sort_by" id="sort_by" class="form-control">
                        <option value="category" {% if form.sort_by.value == 'category' %}selected{% endif %}>Category</option>
                        <option value="date" {% if form.sort_by.value == 'date' %}selected{% endif %}>Date</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="order" class="form-label">Order:</label>
                    <select name="order" id="order" class="form-control">
                        <option value="asc" {% if form.order.value == 'asc' %}selected{% endif %}>Ascending</option>
                        <option value="desc" {% if form.order.value == 'desc' %}selected{% endif %}>Descending</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Search</button>
            </form>
        </div>

        <!-- Expenses table and summaries -->
        <div class="col-md-9">
            <div class="bg-light p-3 mb-4 rounded">
                <h3>Total Amount Spent: <strong>{{ total_spent|floatformat:2 }}</strong></h3>
            </div>

            <!-- Expenses Table -->
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Category</th>
                        <th>Name</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for obj in object_list %}
                    <tr>
                        <td>{{ page_obj.start_index|add:forloop.counter0 }}.</td>
                        <td>{{ obj.category|default:"-" }}</td>
                        <td>{{ obj.name|default:"-" }}</td>
                        <td>{{ obj.amount|floatformat:2 }}</td>
                        <td>{{ obj.date|date:"d-m-Y" }}</td>
                        <td>
                            <a href="{% url 'expenses:expense-edit' obj.id %}" class="btn btn-warning btn-sm">Edit</a>
                            <a href="{% url 'expenses:expense-delete' obj.id %}" class="btn btn-danger btn-sm">Delete</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No items</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% include "_pagination.html" %}

            <hr>

            <!-- Summary per Category -->
            <div class="row">
                <div class="col-md-6 mb-4">
                    <h5 class="mb-3">Summary per category</h5>
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category, total in summary_per_category.items %}
                            <tr>
                                <td>{{ category }}</td>
                                <td>{{ total|floatformat:2 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="2" class="text-center">No data available.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Summary per Year and Month -->
                <div class="col-md-6 mb-4">
                    <h5 class="mb-3">Summary per Year and Month</h5>
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Month</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in summary_per_year_month %}
                            <tr>
                                <td>{{ row.year }}</td>
                                <td>{{ row.month }}</td>
                                <td>{{ row.total_amount|floatformat:2 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center">No data available.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
